<!doctype html public "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=Windows-1250">
<title>Triggery - popis syntaxe (SQL)</title>
<link rel='stylesheet' style='text/css' href='../function.css'>
</head>

<body bgcolor="#FFFFFF" text="#000000"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
	<td style="background-image: url(../images/bghead.jpg);
		background-position: right;
		background-repeat: no-repeat;">
	<table width="100%" border="0" cellpadding="0" cellspacing="0"
		style="background-image:none">
	<tr>
		<td style="background-image:none" height="46"
			width="15%"><img src="../images/title-cz.gif"
			width="255" height="33"
			alt="602SQL-Úplná dokumentace"
			title="602SQL - Úplná dokumentace"
			border="0"></td>
		<td width="33%" align="right"><a href="../xml/html/top.html"><img class="floatno"
			src="../images/index.gif"
			width="15" height="16"
			alt="Index" title="Zpìt na obsah"
			border="0" vspace="2"></a> &nbsp;
			 </td>
	</tr>
	</table>
	</td>
</tr>
</table><table class="navigace" border="0" width="100%"  bgcolor="#FFFFBF">
		  <tr>
					 <td width="20" align="center">&nbsp;</td>
					 <td width="25%">&nbsp;</td>
					 <td width="25%"
align="right"><img class="floatno" src="../images/up.gif" width="13"
height="15" alt="Nahoru" title="O jednu úroveò vıš" border="0"
align="middle"></td><td width="25%"><a href="HE_SQL2_TRIGGERY.htm">Triggery</a></td>
<td width="25%" align="right"><a
href="../xml/html/updatetrigger.html">Spouštìní UPDATE triggerù s uvedenım seznamem sloupcù</a></td><td width="20"
align="center"><img class="floatno" src="../images/next.gif" width="15"
height="13" alt="&shy;&gt;" title="Následující téma" border="0"></td>
</tr></table>





<h1><a name="he_sql2_triggerypopis"></a>Syntaxe popisu triggeru (SQL)</h1>

<pre><code>popis_triggeru ::= TRIGGER [schéma.]jméno_triggeru [ BEFORE | AFTER ] akce ON jméno_tabulky 
    [&nbsp;reference ] [ granularita ] [ WHEN ( podmínka ) ] pøíkaz
akce ::= INSERT | DELETE | UPDATE [ OF [ pravidlo ] sloupec { , sloupec }… ] 
reference ::= REFERENCING { OLD [ ROW ] [ AS ] stará_øádka | NEW [ ROW ] [ AS ] nová_øádka }… 
granularita ::= FOR EACH { ROW | STATEMENT }
pravidlo ::= = | ANY</code></pre>

<p><i>Jméno triggeru</i> musí bıt unikátní v rámci aplikace. <i>Jméno tabulky</i> musí oznaèovat tabulku existující v rámci stejné aplikace a <i>sloupce</i> musí bıt jména vybranıch sloupcù této tabulky. Specifikace INSERT, DELETE nebo UPDATE øíká, pøi jaké operaci s obsahem tabulky bude trigger spuštìn. Jsou-li za UPDATE uvedena navíc jména sloupcù, bude spuštìn pouze pøi operacích modifikujících tuto mnoinu sloupcù, není-li seznam sloupcù uveden, trigger se spustí pøi zmìnì v kterémkoliv sloupci. Viz <a href="../xml/html/updatetrigger.html">Spouštìní UPDATE triggerù s uvedenım seznamem sloupcù</a>.</p>

<p>Identifikátory <i>stará øádka</i> a <i>nová øádka</i> umoòují odvolávat se v podmínce a v pøíkazu na obsah databázového záznamu pøed a po provedení akce, která trigger spustila. Zápis ve tvaru <code>stará_øádka.sloupec</code> resp. <code>nová_øádka.sloupec</code> oznaèuje starou resp. novou hodnotu sloupce. Je-li uvedeno INSERT, nesmí bıt uvedena <i>stará øádka</i>, je-li uvedeno DELETE, nesmí bıt uvedena <i>nová øádka</i>, nebo tyto pojmy nemají v tìchto pøípadech smysl. Identifikátory <i>stará øádka</i> a <i>nová øádka</i> nesmí bıt stejné.</p>

<p>Specifikace FOR EACH ROW øíká, e trigger bude spuštìn pro kadı zmìnìnı øádek zvláš. Specifikace FOR EACH STATEMENT øíká, e bude spuštìn pouze jednou v rámci provádìní celého SQL pøíkazu, pøi nìm se mìní více øádkù najednou. Není-li uvedeno jedno ani druhé, míní se FOR EACH STATEMENT. Specifikace nové øádky a staré øádky je povolena pouze v pøípadì, e je uvedeno FOR EACH ROW. Transientní tabulky triggerù (doèasné tabulky obsahující smazané nebo vloené záznamy) nejsou ve 602SQL zatím implementovány, proto se varianta triggerù FOR EACH STATEMENT nedá pouít, potøebujete-li èíst staré a nové hodnoty v mìnìnıch øádcích. V této verzi je proto doporuèováno pouít FOR EACH ROW vdy.</p>

<p>Pøi spuštìní <a href="HE_SQL2_TRIGGERY.htm">triggeru</a> se nejprve vyhodnotí <a href="HE_SQL2_PODMINKA.htm"><i>podmínka</i></a> (je moné se v ní odkazovat i na staré a nové hodnoty mìnìnıch sloupcù), a je-li splnìná, provede se <i>pøíkaz</i> (<a href="HE_SQL2_PRIKAZY.htm">jednoduchı</a> nebo <a href="HE_SQL2_SLOZENYPRIKAZ.htm">sloenı</a>). V rámci <i>podmínky</i> ani <i>pøíkazu</i> nesmí bıt proveden pøíkaz otevírající nebo uzavírající transakci - chybovı <a href="../xml/html/handlingcategories.html">sqlstate</a> 2D000 (SQ_INVAL_TRANS_TERM).</p>

<p>BEFORE trigger pøi svém provádìní vidí v tabulce pùvodní verzi dat, zatímco AFTER trigger vidí ji zmìnìnou verzi dat. Ostatní klienti vidí zmìny (zpùsobené pøíkazem SQL nebo triggery) a po uzavøení transakce.</p>

<p><b>Pøíklad pouití:</b></p>

<p>trigger zajistí, e pøi vkládání záznamu do tabulky Firmy bude sloupec <i>nazev</i> zapsán velkımi písmeny</p>

<pre><code>TRIGGER VelkaPismena AFTER INSERT ON Firmy
REFERENCING NEW ROW AS novaradka
FOR EACH ROW
BEGIN
 SET novaradka.nazev=UPPER(novaradka.nazev);
END</code></pre>

<p><b>Viz</b></p>

<ul class='viz'><li><a href="HE_SQL2_CREATETRIGGER.htm">CREATE TRIGGER</a> <li><a href="HE_SQL2_ALTERTRIGGER.htm">ALTER TRIGGER</a> <li><a href="HE_SQL2_DROPTRIGGER.htm">DROP TRIGGER</a></ul>



<table class="navigace" border="0" width="100%"  bgcolor="#FFFFBF">
		  <tr>
					 <td width="20" align="center">&nbsp;</td>
					 <td width="25%">&nbsp;</td>
					 <td width="25%"
align="right"><img class="floatno" src="../images/up.gif" width="13"
height="15" alt="Nahoru" title="O jednu úroveò vıš" border="0"
align="middle"></td><td width="25%"><a href="HE_SQL2_TRIGGERY.htm">Triggery</a></td>
<td width="25%" align="right"><a
href="../xml/html/updatetrigger.html">Spouštìní UPDATE triggerù s uvedenım seznamem sloupcù</a></td><td width="20"
align="center"><img class="floatno" src="../images/next.gif" width="15"
height="13" alt="&shy;&gt;" title="Následující téma" border="0"></td>
</tr></table>

</body>
</html>

<!doctype html public "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=Windows-1250">
<title>Chyby a jejich ošetøování v SQL</title>
<link rel='stylesheet' style='text/css' href='../function.css'>
</head>

<body bgcolor="#FFFFFF" text="#000000">

<h1><a name="he_sql2_chyby"></a>Chyby a jejich ošetøování v SQL</h1>

<p>Norma SQL pøedepisuje, že chybové stavy a varování mají být oznaèovány pomocí tzv. <i>sqlstates</i>, což jsou øetìzce pìti znakù složené z&nbsp;èíslic a velkých písmen latinské abecedy. Norma pro øadu chyb pøedepisuje, který <i>sqlstate</i> má pøi jejich výskytu nastat. Mimo to ponechává prostor pro <i>sqlstates</i> definované implementací.</p>

<p>Ve 602SQL jsou chyby oznaèovány èíslem. Nìkteré z&nbsp;tìchto chyb odpovídají nìkterému <i>sqlstate</i>, jiné jsou specifické po 602SQL. Vzhledem k&nbsp;tomu, že pro vìtšinu syntaktických chyb a všechny chyby z&nbsp;nedostatku práv existuje jediný <i>sqlstate</i>, poskytují èísla chyb 602SQL detailnìjší rozlišení.</p>

<p>Na <i>sqlstates </i>se v&nbsp;pøíkazech SQL odvolávají deklarace výjimek a handlerù. Chcete-li zachytit a zpracovat urèitou chybu, musíte znát její <i>sqlstate</i>. Níže uvedená tabulka specifikuje <i>sqlstates</i> odpovídající jeden k&nbsp;jedné chybám 602SQL. Ostatní (implementací definované) chyby se vyjadøují pomocí <i>sqlstate</i> ve tvaru ”W<i>abcd</i>”, kde <i>abcd</i> je ètyømístné èíslo chyby, doplnìné v&nbsp;pøípadì potøeby zleva nulami. Napøíklad chybì 171(deadlock) odpovídá <i>sqlstate</i> W0171. Pomocí tìchto výjimek NELZE odchytit i chyby pøi kompilaci vloženého SQL pøíkazu volaného pomocí <a href="HE_F_SQLEXECUTE.htm"><code>SQL_execute</code></a>.</p>

<p>Od verze 7 jsou v jazyce zavedeny <a href="../xml/html/sysvars.html">systémové promìnné</a>   <code>sqlstate</code> typu CHAR pro zjištìní hodnoty sqlstate a <code>sqlcode</code> typu INT ve významu èísla chyby 602SQL. Lze je využít v handlerech pro podrobnìjší ošetøení nebo logování chybových stavù.</p>

<p>Podrobnìjší rozdìlení všech chyb do kategorií podle možnosti reakce na jejich výskyt lze nalézt <a href="../xml/html/errorexceptions.html">zde</a>.</p>

<table cols=3 >

<tr valign="top">
<td width=63%><b>Název<i> sqlstate</i></b></td>
<td width=18%><b>èíslo chyby ve 602</b><b>SQL</b></td>
<td width=19%><b><i>sqlstate</i></b></td>
</tr>

<tr valign="top">
<td width=63%>Kurzor nelze nastavit na neexistující záznam</td>
<td width=18%>139</td>
<td width=19%>02000</td>
</tr>

<tr valign="top">
<td width=63%>Porušeno omezení tabulky (NOT NULL nebo UNIQUE nebo CHECK nebo referenèní integrita)</td>
<td width=18%>160,172,174,
<p>175</p>
</td>
<td width=19%>40002</td>
</tr>

<tr valign="top">
<td width=63%>Neplatný stav kurzoru</td>
<td width=18%>196</td>
<td width=19%>24000</td>
</tr>

<tr valign="top">
<td width=63%>Neplatné oznaèení savepointu</td>
<td width=18%>197</td>
<td width=19%>3B001</td>
</tr>

<tr valign="top">
<td width=63%>Pøekroèen limit na poèet savepointù</td>
<td width=18%>198</td>
<td width=19%>3B002</td>
</tr>

<tr valign="top">
<td width=63%>Transakce je již zahájena</td>
<td width=18%>199</td>
<td width=19%>25001</td>
</tr>

<tr valign="top">
<td width=63%>Nedovolené ukonèení transakce v&nbsp;atomickém pøíkazu</td>
<td width=18%>200</td>
<td width=19%>2D000</td>
</tr>

<tr valign="top">
<td width=63%>Tato transakce nesmí modifikovat data</td>
<td width=18%>201</td>
<td width=19%>25006</td>
</tr>

<tr valign="top">
<td width=63%>Èíselná hodnota mimo povolený rozsah</td>
<td width=18%>202</td>
<td width=19%>22003</td>
</tr>

<tr valign="top">
<td width=63%>Nepøípustný znak znemožòuje konverzi typu</td>
<td width=18%>203</td>
<td width=19%>22018</td>
</tr>

<tr valign="top">
<td width=63%>Øetìzec znakù je pøíliš dlouhý</td>
<td width=18%>204</td>
<td width=19%>22001</td>
</tr>

<tr valign="top">
<td width=63%>Dìlení nulou</td>
<td width=18%>205</td>
<td width=19%>22012</td>
</tr>

<tr valign="top">
<td width=63%>Odpovìï obsahuje jiný poèet záznamù než jeden</td>
<td width=18%>206</td>
<td width=19%>21000</td>
</tr>

<tr valign="top">
<td width=63%>Chyba v&nbsp;urèení znaku ESCAPE</td>
<td width=18%>207</td>
<td width=19%>22019</td>
</tr>

<tr valign="top">
<td width=63%>Pøíkaz CASE neobsahuje vhodnou vìtev</td>
<td width=18%>208</td>
<td width=19%>20000</td>
</tr>

<tr valign="top">
<td width=63%>Uživatelem definovaná výjimka není ošetøena</td>
<td width=18%>209</td>
<td width=19%>45000</td>
</tr>

<tr valign="top">
<td width=63%>Pøíkaz RESIGNAL použit mimo ošetøení výjimky</td>
<td width=18%>210</td>
<td width=19%>0K000</td>
</tr>

<tr valign="top">
<td width=63%>Externí rutina nebo knihovna nebyla nalezena</td>
<td width=18%>211</td>
<td width=19%>38001</td>
</tr>

<tr valign="top">
<td width=63%>Ve funkci nebyl proveden pøíkaz RETURN</td>
<td width=18%>212</td>
<td width=19%>2F001</td>
</tr>

<tr valign="top">
<td width=63%>Chyba v akci spuštìné triggerem</td>
<td width=18%>214</td>
<td width=19%>09000</td>
</tr>

<tr valign="top">
<td width=63%>Kurzor tohoto jména neexistuje</td>
<td width=18%>217</td>
<td width=19%>34000</td>
</tr>
</table><br>

<p><b>Pøíklad použití promìnné sqlstate:</b></p>

<p>Obecný handler pro všechny chyby</p>

<pre><code>DECLARE CONTINUE HANDLER FOR SQLEXCEPTION
  BEGIN
    CALL log_write("Procedura ... - "||<b>sqlstate</b>||' '||Int2str(<b>sqlcode</b>));
  END;</code></pre>

</body>
</html>

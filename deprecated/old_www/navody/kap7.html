<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=Windows-1250"><title>7. Integritní omezení v SQL</title>


	
	<link rel="STYLESHEET" type="text/css" href="kap7_soubory/main.css">
	<style type="text/css"><!--:hover { font-weight: bold;         color: red }
--></style></head><body alink="Blue" background="kap7_soubory/pozadi.jpg" vlink="Blue">
<a href="http://www.cs.vsb.cz/amalka/tomica/sql/kap6.html"><img src="kap7_soubory/prev.gif" alt="6. Ochrana dat proti neoprávnìnému pøístupu"></a>
<a href="http://www.cs.vsb.cz/amalka/tomica/sql/kap8.html"><img src="kap7_soubory/next.gif" alt="8. Programování s SQL"></a>
<a href="http://www.cs.vsb.cz/amalka/tomica/sql/index.html"><img src="kap7_soubory/toc.gif" alt="Obsah"></a>
<hr color="Blue" size="1">
<h1>7. Integritní omezení v SQL</h1>
<p>Implementace jazyka SQL nenabízejí pøíliš mnoho možností pro
formulaci IO. Standard SQL86 pøipouští vlastnì pouze NOT NULL a UNIQUE.
Standard SQL89 rozšiøuje možnosti IO na kontrolování hodnoty komponenty
n-tice relace (klauzule CHECK - lokální pro daný atribut nebo globální
pro atributy jedné relace), zadání implicitní hodnoty pøi vkládání
n-tice do relace (klauzule DEFAULT) a zadání referenèní integrity
pomocí explicitnì definovaného primárního klíèe (PRIMARY KEY) a cizích
klíèù (FOREIGN KEY).</p>
<p>Ve schématu Vypujcka jsou zøejmì id_v a cislo cizími klíèi.
Oznaèíme-li tedy v definici relace Vypujcka atribut id_v za cizí klíè s
odkazem na relaci Exemplar, mìl by SØBD kontrolovat pøi vstupu prvku do
relace Vypujcka, zda inventární èíslo zapùjèené knihy existuje v
seznamu exempláøù. Dále pøedpokládejme, že èísla ètenáøù jsou vìtší než
100, a v pøípadì prázdné hodnoty atributu d_zpet požadujme, aby SØBD
dosadil datum konce roku. Pak lze schéma relace Vypujcka popsat
následovnì:</p>
<pre>CREATE TABLE Vypujcka
    (id_v INTEGER NOT NULL,
     cislo INTEGER NOT NULL CHECK (cislo &gt;= 100), 
     d_zpet DATE DEFAULT 12/31 /89),
     PRIMARY KEY (id_v),
     FOREIGN KEY (id_v) REFERENCES Exemplar,
     FOREIGN KEY (cislo) REFERENCES Ctenar)</pre>
<p>Podobnì lze definovat i další používaná schémata jako napø.</p>
<pre>CREATE TABLE Dodava
    ( ...
     PRIMARY KEY (JMÉNO_K,NÁZEV_K),
     FOREIGN KEY (NÁZEV_K) REFERENCES Knihovna,
     FOREIGN KEY (JMÉNO_K) REFERENCES Knihkupec)</pre>
<p>Poznamenejme, že definice id_v jako PRIMARY KEY je sémanticky
identická s užitím UNIQUE, avšak s tím rozdílem, že v CREATE TABLE lze
použít klauzuli PRIMARY KEY pouze jednou. Atributy za PRIMARY KEY je
ovšem nutné specifikovat jako NOT NULL. Za klauzulí CHECK se mùže
vyskytnout Booleovský výraz jednoduchých podmínek týkajících se
atributù daného schématu (je-li CHECK použita globálnì), tj. jde o
selektivní omezení. Klauzule CHECK použitá lokálnì obsahuje pouze
odkazy na daný atribut a vlastnì dovoluje jemnìji specifikovat doménu
daného atributu.</p>
<p>Jak vidíme z pøíkladu, klauzule DEFAULT je vhodnìjší než použití
prázdných hodnot. Vede napø. k tomu, že neexistenci hodnoty lze ošetøit
rùznými implicitními hodnotami. což zlepšuje sémantiku ukládaných dat.</p>
<p>Referenèní integrita mùže být použita i rekurzivnì, tj. hodnota
atributu tabulky v jednom øádku mùže být hodnotou klíèe tabulky z
jiného øádku.</p>
<pre>CREATE TABLE Synonyma
    (KEY_WORD CHARACTER(12) PRIMARY KEY
     S_KEY_WORD CHARACTER(12) REFERENCES Synonyma)</pre>
<p>Zavedení PRIMARY KEY umožòuje jednoduše formulovat referenèní
integritu. Za REFERENCES není nutné vyjadøovat, o který atribut jde,
implicitnì se myslí primární klíè.</p>
<p>Styl vyjádøení referenèní integrity pøes FOREIGN KEY by vedl k ekvivalentnímu zápisu atributu S_KEY_WORD jako:</p>
<pre>FOREIGN KEY (S_KEY_WORD) REFERENCES Synonyma(KEY_WORD)</pre>
<p>Pøi zavedení referenèní integrity v RMD s prázdnými hodnotami je
užiteèné pøipustit, že hodnotou každého atributu cizího klíèe mùže být
prázdná hodnota. Jakýkoliv pokus narušit referenèní integritu vede k
hlášení chyby. Jedná se o použití INSERT, DELETE, jako
napø. vkládání výpùjèky se ètenáøem neexistujícím v tabulce Ctenar,
nebo naopak rušení ètenáøe, na kterého se odkazuje v tabulce Vypujcka.
Je tøeba si však uvìdomit, že zatím jde pouze o kontroly, nikoliv napø.
indukované aplikace DELETE apod. Ty se vyskytují až v dalších verzích
standardu, tj. v SQL92 a pøipravovaném SQL3.</p>
<p class="BEZ"><i>Poznámka:</i> Informace o referenèní integritì,
splnìné v nìjaké verzi SQL daného produktu, ještì nemusí znamenat, že
se konsistence databáze skuteènì kontroluje. Mùže jít pouze a
syntaktické možnosti ve snaze zachovat kompatibilitu s jinými systémy
podporujícími SQL (viz napø. SQL
Server firmy Microsoft).</p>
<hr color="Blue" size="1">
<a href="http://www.cs.vsb.cz/amalka/tomica/sql/kap6.html"><img src="kap7_soubory/prev.gif" alt="6. Ochrana dat proti neoprávnìnému pøístupu" align="left"></a>
<a href="http://www.cs.vsb.cz/amalka/tomica/sql/kap8.html"><img src="kap7_soubory/next.gif" alt="8. Programování s SQL" align="left"></a>
<a href="http://www.cs.vsb.cz/amalka/tomica/sql/index.html"><img src="kap7_soubory/toc.gif" alt="Obsah" align="left"></a>
</body></html>
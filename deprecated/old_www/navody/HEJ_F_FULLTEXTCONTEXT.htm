<!doctype html public "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=Windows-1250">
<title>Funkce Fulltext_context</title>
<link rel='stylesheet' style='text/css' href='../function.css'>
</head>

<body bgcolor="#FFFFFF" text="#000000">



<h2 class=function>Fulltext_context</h2>
<img src='../images/sql.gif' width='44' height='16' border='0' alt='sql' align='middle' hspace='2'>

<br><br>
<div class='typ'>function <b>Fulltext_context</b>(IN doc BLOB, IN format CHAR(10), IN mode INT, IN position INT, IN margin INT, IN decoration CHAR(50)); returns CLOB;
</div>

<p><b>Parametry:</b></p>

<table border=1 cols=2>

<tr valign="top">
<td><i>doc </i></td>
<td>dokument nebo odkaz na dokument</td>
</tr>

<tr valign="top">
<td><i>format</i></td>
<td>formát dokumentu (TXT, TEXT nebo PLAIN pro èistý text, RTF, DOC nebo HTML apod. pro ostatní definované) nebo prázdný øetìzec</td>
</tr>

<tr valign="top">
<td><i>mode</i></td>
<td>zpùsob pøedání dokumentu</td>
</tr>

<tr valign="top">
<td><i>position</i></td>
<td>pozice (slova) v dokumentu, kolem níž se hledá kontext</td>
</tr>

<tr valign="top">
<td><i>margin</i></td>
<td>poèet slov pøed a za <i>position</i> v kontextu</td>
</tr>

<tr valign="top">
<td><i>decoration</i></td>
<td>znaky, kterými se "obalí" slovo v pozici "position" ve výsledném kontextu </td>
</tr>
</table><br>

<p><b>Od verze:</b></p>
<p>7.0d, ve verzi 9.5 zastaralá</p>

<p><b>Popis:</b></p>

<p>Funkci lze od verze 9.5 používat na textové dokumenty, pro binární dokumenty zpracované externími konvertory nemusí funkce pracovat správnì. Pro verzi 9.5 existuje funkce obdobná - <a href="../xml/html/f_fulltext_get_context.html"><code>Fulltext_get_context</code></a>.</p>

<p>Funkce vrátí kontext (text okolo) výskytu (jednoho) slova vyhledaného pomocí predikátu <code>Fulltext</code>. </p>

<p>Prohledávaný dokument lze pøedat dvojím zpùsobem, pøièemž zpùsob pøedání popisuje parametr <em>mode</em> takto: </p>

<table border=1 >
<tr><td><strong>hodnota</strong></td><td><strong>&nbsp;&nbsp;popis</strong></td></tr>
<tr><td>0 </td>	<td>dokument je obsahem parametru <i>doc</i> (textovì nebo binárnì)</td></tr>
<tr><td>1 </td><td>dokument je v souboru, jehož jméno je v parametru <i>doc</i></td></tr>
</table>
<br>
<p>Pomocí <i>format</i> lze urèit, v jakém formátu se pøedpokládají texty k indexování. Znáte-li formát pøedem (napø pøi indexování CLOBù v tabulce), použijte zkratku pro daný formát (napø. TXT), neznáte-li jej (napø. pøi indexování obsahu souborù v adresáøi), použijte prázdný øetìzec - probìhne analýza poèátku textu a pro známé formáty se použije odpovídající konvertor. Nepodaøí-li se analýza, funkce skonèí s chybou. </p>

<p>Pozice slova v dokumentu mùže být dána systémovou promìnnou <code>@@FULLTEXT_POSITION</code>, která je nastavena pøi každém vyhodnocení predikátu <code>Fultext</code> vracejícím TRUE. Pøi vyhledání víceslovné fráze bude pozice ukazovat na jedno ze slov.</p>

<p>Parametrem <i>margin</i> stanovíte, kolik slov pøed a za nalezeným slovem se vrátí (spolu se slovem a znaky zadanými v <i>decoration</i>) jako výsledek funkce.</p>

<p>Pomocí <i>decoration</i> lze zvýraznit hledané slovo v kontextu. Øetìzcový parametr musí mít následující tvar <i><code>znaky_pøed%znaky_po</code></i>, kde % znaèí pozici hledaného slova. Bude-li výsledek funkce napø. pøedán browseru jako HTML, lze s výhodou použít tohoto zvýraznìní: <code>"&lt;B&gt;%&lt;/B&gt;"</code> </p>

<p><b>Hodnota funkce</b></p>

<p>Funkce vrací kontext výskytu slova délky <i>2*margin+1 </i>slov.</p>

<p><b>Pøíklady:</b></p>

<p>Nalézt v dokumentech uložených v databázi slovo Databáze a vrátit kontexty jeho výskytu: </p>

<pre>SELECT Fulltext_context(doc,"TXT",0,@@FULLTEXT_POSITION,5,"&gt;&gt;%&lt;&lt;")
FROM Doctab
WHERE Fulltext(".ftx_test",id,"Databáze")
</pre>

<p>Totéž zadání - v proceduøe pomocí prùchodu kurzoru: </p>

<pre>DECLARE pom CLOB;
FOR radek AS ftcur INSENSITIVE CURSOR FOR
  SELECT id,doc,@@FULLTEXT_POSITION AS pos
  FROM Doctab
  WHERE Fulltext(".ftx_test",id,"Databáze")
DO
  SET pom = Fulltext_context(radek.doc,"TXT",0,radek.pos,5,"&gt;&gt;%&lt;&lt;");
  CALL log_write(pom);
END FOR;</pre>

<p><b>Viz</b></p>

<ul class='viz'>
 <li><a href="../xml/html/fulltext.html">Fulltextové nástroje ve 602SQL</a> </li>
 <li><a href="../xml/html/fulltext_doctab.html">Oznaèování a uložení dokumentù ve fulltextových systémech</a> </li>
 <li><a href="../xml/html/fulltext_search.html">Fulltextové vyhledávání dokumentù</a></li>
</ul>

</body>
</html>

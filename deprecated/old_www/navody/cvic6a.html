<!DOCTYPE html PUBLIC "-//w3c//dtd html 4.0 transitional//en">
<html><head>


   <meta http-equiv="Content-Type" content="text/html; charset=windows-1250">
   <meta name="ProgId" content="Word.Document">
   <meta name="Generator" content="Microsoft Word 9">
   <meta name="Originator" content="Microsoft Word 9">
   <meta name="GENERATOR" content="Mozilla/4.78 [en] (Win98; U) [Netscape]"><title>6. cvièení</title>
   
<link rel="File-List" href="file:///A%7C/cvic1_soubory/filelist.xml"><!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>tih30</o:Author>
  <o:LastAuthor>tih30</o:LastAuthor>
  <o:Revision>2</o:Revision>
  <o:TotalTime>56</o:TotalTime>
  <o:Created>2002-09-10T07:25:00Z</o:Created>
  <o:LastSaved>2002-09-10T08:26:00Z</o:LastSaved>
  <o:Pages>2</o:Pages>
  <o:Words>219</o:Words>
  <o:Characters>1252</o:Characters>
  <o:Company>VŠB-TU Ostrava</o:Company>
  <o:Lines>10</o:Lines>
  <o:Paragraphs>2</o:Paragraphs>
  <o:CharactersWithSpaces>1537</o:CharactersWithSpaces>
  <o:Version>9.3821</o:Version>
 </o:DocumentProperties>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:HyphenationZone>21</w:HyphenationZone>
 </w:WordDocument>
</xml><![endif]-->


<style>
<!--
 /* Style Definitions */
p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
p
	{font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
pre
	{margin:0cm;
	margin-bottom:.0001pt;
	font-size:10.0pt;
	font-family:"Courier New";
	mso-fareast-font-family:"Courier New";}
@page Section1
	{size:595.3pt 841.9pt;
	margin:70.85pt 70.85pt 70.85pt 70.85pt;
	mso-header-margin:35.4pt;
	mso-footer-margin:35.4pt;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
-->
</style></head><body style="" lang="CS">

<div class="Section1">
<h2>
6. cvièení</h2>

<h1>
Programování v PL/SQL</h1>
  <p>Vytvoøte proceduru, která naplní tabulku 10 záznamy. Do èíselného sloupce vloží 
    èíslo, do druhého x zvìtšované v každém cyklu o 100, do textového informaci, 
    jestli je sudé nebo liché. Výstupním parametrem bude souèet x pro celou tabulku. 
    Varianta, poèet vytvoøených záznamù bude dán vstupním parametrem procedury. 
    Varianta vstupním parametrem bude poèet prùchodù cyklem. </p>
  
  <pre><font color="#0000ff">DROP TABLE temp;
CREATE TABLE temp(cis1 NUMBER(4), cis2 NUMBER(4), znak VARCHAR2(10));

CREATE OR REPLACE PROCEDURE licha_suda ( p OUT NUMBER) AS&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp; x NUMBER :=100;
&nbsp;&nbsp; BEGIN
&nbsp;&nbsp;&nbsp;&nbsp; FOR i IN 1..10 LOOP
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IF MOD (i, 2) = 0 THEN&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; INSERT INTO temp VALUES (i, x, 'sude');
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ELSE
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; INSERT INTO temp VALUES (i, x, 'liche');
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; END IF;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; x := x + 100;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; END LOOP;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; p:=x;
&nbsp; END;
/

VAR soucet NUMBER
EXEC licha_suda(:soucet);
PRINT soucet
SELECT * FROM temp;
</font></pre>
  <pre>varianta se vstupním parametrem:

</pre>
  <pre><font color="#0000ff">CREATE OR REPLACE PROCEDURE licha_suda ( p OUT NUMBER, s IN NUMBER) AS&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp; x NUMBER :=100;
&nbsp;&nbsp; BEGIN
&nbsp;&nbsp;&nbsp;&nbsp; FOR i IN 1..s LOOP
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IF MOD (i, 2) = 0 THEN&nbsp;&nbsp;&nbsp; --i is even
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; INSERT INTO temp VALUES (i, x, 'sude');
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ELSE
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; INSERT INTO temp VALUES (i, x, 'liche');
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; END IF;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; x := x + 100;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; END LOOP;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; p:=x;
&nbsp; END;
/

VAR soucet NUMBER
EXEC licha_suda(:soucet, 20);
PRINT soucet
SELECT * FROM temp;

</font>varianta s cyklem WHILE

</pre>
  <pre><font color="#0000ff">CREATE OR REPLACE PROCEDURE licha_suda ( p OUT NUMBER, s IN NUMBER) AS&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp; x NUMBER :=100;
&nbsp;&nbsp;&nbsp;&nbsp; i NUMBER :=1;
&nbsp;&nbsp; BEGIN
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WHILE i&lt;=s LOOP
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IF MOD (i, 2) = 0 THEN&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; INSERT INTO temp VALUES (i, x, 'sude');
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ELSE
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; INSERT INTO temp VALUES (i, x, 'liche');
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; END IF;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; i := i+1;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; x := x + 100;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; END LOOP;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; p:=x;
&nbsp; END;
/

VAR soucet NUMBER
EXEC licha_suda(:soucet, 20);
PRINT soucet
SELECT * FROM temp;
</font></pre>
  <pre>varianta s cyklem LOOP

</pre>
  <pre><font color="#0000ff">CREATE OR REPLACE PROCEDURE licha_suda ( p OUT NUMBER, s IN NUMBER) AS&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp; x NUMBER :=100;
&nbsp;&nbsp;&nbsp;&nbsp; i NUMBER :=1;
&nbsp;&nbsp; BEGIN
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; LOOP
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IF MOD (i, 2) = 0 THEN&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; INSERT INTO temp VALUES (i, x, 'sude');
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ELSE
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; INSERT INTO temp VALUES (i, x, 'liche');
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; END IF;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; i := i+1;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; x := x + 100;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; EXIT WHEN i&gt;s;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; END LOOP;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; p:=x;
&nbsp; END;
/

VAR soucet NUMBER
EXEC licha_suda(:soucet, 20);
PRINT soucet
SELECT * FROM temp;</font></pre>
  <p>Udìlení práv SELECT, UPDATE, DELETE na tabulku STUDENT a práv SELECT, UPDATE 
    pro tabulku SKUPINA a SELECT pro tabulku CVICENI a VYUCUJICI. Vytvoøení public 
    synonym pro tabulky uživatele DAIS2. Trigger, který zaznamenává zmìny, které 
    byly nad tabulkou STUDENT a SKUPINA provedeny.</p>
  
  <pre><font color="#0000ff">SQL&gt; connect dais2@sp2
SQL&gt; grant select, update,delete on student to public;
SQL&gt; grant select, update on skupina to public;
SQL&gt; grant select on cviceni to public;
SQL&gt; grant select on vyucujici to public;

SQL&gt; connect tih30adm@sp2
SQL&gt; grant create public synonym to dais2;

SQL&gt; connect dais2@sp2
SQL&gt; create public synonym student for student;
SQL&gt; create public synonym skupina for skupina;
SQL&gt; create public synonym vyucujici for vyucujici;
SQL&gt; create public synonym cviceni for cviceni;


DROP TABLE zmeny;
CREATE TABLE zmeny(tabulka VARCHAR2(10),kod VARCHAR2(7),login CHAR(6),provedl VARCHAR2(10), datum DATE, stare VARCHAR2(50), nove VARCHAR2(50));

CREATE OR REPLACE TRIGGER zmeny_student 
BEFORE DELETE OR UPDATE ON student
FOR EACH ROW
BEGIN
IF UPDATING THEN
   INSERT INTO zmeny(tabulka, kod,login,provedl,datum,stare,nove)
   VALUES('student','zmena',:OLD.login,USER,SYSDATE,:OLD.login||' '||
   :OLD.jmeno||' '||:OLD.prijmeni||' '||:OLD.cviceni||' '||:OLD.skupina||' '||
   :OLD.mesto||' '||:OLD.narozen,:NEW.login||' '||:NEW.jmeno||' '||
   :NEW.prijmeni||' '||:NEW.cviceni||' '||:NEW.skupina||' '||:NEW.mesto||' '||:NEW.narozen);
ELSIF DELETING THEN
   INSERT INTO zmeny(tabulka,kod,login,provedl,datum)
   VALUES('skupina','zruseni',:OLD.login,USER,SYSDATE);
END IF;   
END;
/

CREATE OR REPLACE TRIGGER zmeny_skupina
BEFORE UPDATE ON skupina
FOR EACH ROW
BEGIN
   INSERT INTO zmeny(tabulka, kod,provedl,datum,stare,nove)
   VALUES('skupina','zmena',USER,SYSDATE,:OLD.cis_sk||' '||:OLD.nazev_sk||' '||
   :OLD.vedouci||' '||:OLD.tema,:NEW.cis_sk||' '||:NEW.nazev_sk||' '||
   :NEW.vedouci||' '||:NEW.tema);   
END;
/

SQL&gt; update skupina set vedouci='?' where vedouci is null;

SQL&gt; select * from zmeny;

TABULKA    KOD     LOGIN  PROVEDL    DATUM     STARE
---------- ------- ------ ---------- --------- ----------------------------------------
NOVE
--------------------------------------------------
student    zmena          DAIS2      07-NOV-02 1 Prvni  IS zakladni skoly
1 Prvni ?      IS zakladni skoly


CREATE OR REPLACE PROCEDURE projdi_test AS
CURSOR s1 IS
&nbsp;&nbsp; SELECT login FROM student ORDER BY prijmeni;
BEGIN
&nbsp;&nbsp; FOR kurz IN s1 LOOP
&nbsp;&nbsp; test_stud(kurz.login);
&nbsp;&nbsp; END LOOP;
END;
/

EXEC projdi_test;</font></pre>
  &nbsp; 
  <p>&nbsp; &nbsp; 
  </p><h1>
Práce se systémovým katalogem</h1>
  <p>Vytvoøení sekvence.</p>
  <p><font color="#0000ff">SQL&gt; CREATE SEQUENCE skupid START WITH 1 INCREMENT 
    BY 1;</font> 
  </p><p>Vypište strukturu tabulky systémového katalogu ve které jsou uloženy sekvence 
    vytvoøené uživatelem </p>
  <p><font color="#0000ff">SQL&gt; DESC user_sequences;</font>
</p><p>Vypište názvy sekvencí
</p><p><font color="#0000ff">SQL&gt; SELECT sequence_name FROM user_sequences;</font>
  </p><p>Vypište aktuální èíslo sekvence SKUPID
  </p>
  <pre><font color="#0000ff">SQL&gt; SELECT skupid.CURRVAL FROM dual;

SELECT skupid.currval FROM dual&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *&nbsp;
CHYBA na øádku 1:&nbsp;
ORA-08002: sekvence SKUPID.CURRVAL není v této relaci ještì definována
</font></pre>
  <p>Chybové hlášení øíká, že tato sekvence nebyla ještì použita. Zmìòte pomocí 
    pøíkazu CHANGE pøíkaz tak, aby se vypsalo následující èíslo sekvence. </p>
  
  <pre><font color="#0000ff">SQL&gt; c/CURRVAL/NEXTVAL
&nbsp;
&nbsp; 1* SELECT skupid.NEXTVAL FROM dual&nbsp;
SQL&gt; /</font></pre>

  <pre><font color="#0000ff">&nbsp; NEXTVAL&nbsp;
---------&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1
</font></pre>
  <p>Proveïte aktualizaci záznamu v tabulce skupina, zmìòte èíslo vaší skupiny za 
    použití sekvence SKUPID. </p>
 
  <pre><font color="#0000ff">SQL&gt; UPDATE skupina&nbsp;&nbsp;&nbsp;
2&nbsp; SET cis_sk=skupid.NEXTVAL&nbsp;&nbsp;&nbsp;
3&nbsp; WHERE nazev_sk ='atleti';&nbsp;

1 row updated.</font></pre>
</div>


<div style="position: absolute; left: 0px; top: 0px; z-index: 1000000000 ! important; visibility: hidden; opacity: 1;" id="linkalert-box"><img src="cvic6a_soubory/none-icon.png" id="linkalert-icon-1"></div></body></html>
<!doctype html public "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=Windows-1250">
<title>Triggery v SQL</title>
<link rel='stylesheet' style='text/css' href='../function.css'>
</head>

<body bgcolor="#FFFFFF" text="#000000"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
	<td style="background-image: url(../images/bghead.jpg);
		background-position: right;
		background-repeat: no-repeat;">
	<table width="100%" border="0" cellpadding="0" cellspacing="0"
		style="background-image:none">
	<tr>
		<td style="background-image:none" height="46"
			width="15%"><img src="../images/title-cz.gif"
			width="255" height="33"
			alt="602SQL-Úplná dokumentace"
			title="602SQL - Úplná dokumentace"
			border="0"></td>
		<td width="33%" align="right"><a href="../xml/html/top.html"><img class="floatno"
			src="../images/index.gif"
			width="15" height="16"
			alt="Index" title="Zpìt na obsah"
			border="0" vspace="2"></a> &nbsp;
			 </td>
	</tr>
	</table>
	</td>
</tr>
</table><table class="navigace" border="0" width="100%"  bgcolor="#FFFFBF"><tr> <td
width="20" align="center"><img class="floatno" src="../images/prev.gif"
width="15" height="13" alt="&lt;&shy;" title="Pøedcházející téma"
border="0"></td><td width="25%"><a
href="HE_SQL2_STOREDPROCEDURE.htm">Rutiny uloené na serveru</a></td> <td width="25%"
align="right"><img class="floatno" src="../images/up.gif" width="13"
height="15" alt="Nahoru" title="O jednu úroveò vıš" border="0"
align="middle"></td><td width="25%"><a href="HE_SQL2_JAZYKSQL.htm">Jazyk SQL a jeho implementace</a></td>
<td width="25%" align="right"><a
href="HE_SQL2_SEKVENCE.htm">Sekvence</a></td><td width="20"
align="center"><img class="floatno" src="../images/next.gif" width="15"
height="13" alt="&shy;&gt;" title="Následující téma" border="0"></td>
</tr></table>




<h1><a name="he_sql2_triggery"></a>Triggery (SQL)</h1>

<p>Trigger je nástroj, kterı zajišuje automatické provedení programu v jazyce SQL pøi vloení, zrušení nebo zmìnì záznamu v urèité tabulce. Trigger mùe napøíklad zajistit, e:

<ul>
	<li>pøed vloením nového záznamu do tabulky bude provedena kontrola jeho obsahu a doplnìny hodnoty nìkterıch sloupcù;</li>
	<li>po smazání záznamu se provedou následné akce;</li>
	<li>pøi zmìnì hodnoty urèitého sloupce v záznamu se porovná stará a nová hodnota a na základì jejich vztahu se provedou další akce.</li>
</ul>

<p>Triggery zjednodušují tvorbu aplikací, protoe pøenášejí èást práce databázové aplikace na server. Umoòují centralizované definování pravidel platnıch pro informaèní systém. Existuje-li napøíklad v podnikovém informaèním systému tabulka zamìstnancù, lze pomocí triggerù popsat, jaké všechny akce musí bıt provedeny pøi pøijetí nebo propuštìní zamìstnance, zmìnì platu nebo pøeøazení do jiného oddìlení. Tyto akce se naprogramují na jednom místì, ale budou slouit všem aplikacím, které manipulují s tabulkou zamìstnancù. Dodrení pravidel pro údrbu evidence zamìstnancù pak bude zajišovat server automaticky a konzistence dat bude zajištìna bez ohledu na moné chyby v mìnících se aplikacích.</p>

<p>Trigger je pojmenovanım objektem patøícím do databázové aplikace. Má tyto vlastnosti:

<ul>
	<li>je svázán s urèitou tabulkou a reaguje na zmìny v této tabulce;</li>
	<li>reaguje na právì jednu z SQL akcí <a href="HE_SQL2_INSERT.htm">INSERT</a>, <a href="HE_SQL2_DELETE.htm">DELETE</a> nebo <a href="HE_SQL2_UPDATE.htm">UPDATE</a>, triggery reagující na UPDATE mohou navíc <a href="../xml/html/updatetrigger.html">specifikovat mnoinu sloupcù</a>, jejich zmìna je spouští; trigger se spouští také provádìním obdobnıch akcí pøi práci s formuláøi;</li>
	<li>provádí se buï pøed (BEFORE) provedením vıše specifikované akce, nebo po ní (AFTER);</li>
	<li>pokud akce ovlivòuje více ne jeden záznam, pak se mùe spouštìt buï pro kadı ovlivnìnı (tj. vloenı, zrušenı nebo zmìnìnı) záznam zvláš, nebo pro všechny záznamy najednou;</li>
	<li>mùe obsahovat podmínku, která se vyhodnotí pøed provedením triggeru a pokud není splnìna, trigger nebude spuštìn;</li>
	<li>specifikuje akci (zapsanou v jazyce SQL), která bude automaticky provedena, jakmile jsou splnìny podmínky pro spuštìní triggeru.</li>
</ul>

<p>Pøi provedení konkrétní akce mohou bıt splnìny podmínky pro spuštìní více ne jednoho triggeru. V takovém pøípadì jsou spuštìny po øadì všechny. V souèasné podobnì návrhu normy SQL 3 není zahrnut zpùsob, jak by uivatel v textu triggerù mohl definovat poøadí jejich spouštìní. Je pravdìpodobné, e pøed definitivní redakcí normy bude tento zpùsob specifikován a poté bude pøidán i do 602SQL.</p>

<p>Provádìní triggerù mùe mìnit obsah databáze a tím spouštìt další triggery. Spouštìní triggerù se mùe do sebe libovolnì zanoøovat.</p>

<p>Pøi provádìní triggerù se nekontrolují práva (triggery se provádìjí s maximálními právy). Aby díky tomu nemohlo dojít k neoprávnìnému pøístupu k datùm, mùe triggery vytváøet pouze uivatel obsazenı do <a href="../xml/html/role.html">role</a> <code>Author</code> v aplikaci, do ní trigger patøí. V <a href="../xml/html/lockedappl.html">zamèené aplikaci</a> není tedy moné triggery vytváøet.</p>

<p>INSERT a UPDATE triggery se nespouštìjí pøi importu dat do tabulky<!-- ani pøi replikacích-->. DELETE triggery se nespouštìjí pøi smazání tabulky jako objektu (pøi mazání záznamù samozøejmì ano). Spouštìní triggerù pøi akcích vyvolanıch aktivní referenèní integritou závisí na nastavení <a href="../xml/html/sqloptions.html">pøíznaku kompatibility</a> SQLOPT_NO_REFINT_TRIGGERS (4096)</p>

<p>Pro úèely ladìní mùe bıt vıhodné <a href="../xml/html/tracelog.html">trasovat</a> spouštìní triggerù (situace <code>TRACE_TRIGGER_EXEC</code>), triggery lze také <a href="../xml/html/debugger.html">debugovat</a> stejnì jako procedury.</p>

<h2>Triggery a transakce</h2>
<p>Trigger se vdy provádí jako souèást <a href="HE_SQL2_TRANSAKCE.htm">transakce</a>, v ní je spuštìn pøíkaz, kterı trigger spustil. <a href="../xml/html/errortransaction.html">Chyba</a>, která pøípadnì nastane pøi provádìní triggeru, má stejné dùsledky, jako chyba ve spouštìcím pøíkazu - trigger nelze odvolat bez odvolání tohoto pøíkazu, pøíkaz nelze odvolat bez odvolání zmìn provedenıch triggerem.</p>

<p>Chyby <a href="../xml/html/handlingcategories.html">kategorie</a> "rollback exception condition", pokud se vyskytnou uvnitø triggeru, ignorují vnitøní deklarace handlerù (tj. handlery v triggeru a procedurách volanıch tímto triggerem). Zachytit je lze pouze handlerem pro spouštìcí pøíkaz.</p>

<p>Uvnitø triggerù se nesmí provádìt ádné explicitní <a href="HE_SQL2_TRANSAKCE.htm">transakèní pøíkazy</a>, v opaèném pøípadì nastane chybovı <a href="../xml/html/handlingcategories.html">sqlstate</a> 2D000 (SQ_INVAL_TRANS_TERM).</p>




<p class="subs">Seznam subsekcí:
<ul class="subs">

<li><a href="HE_SQL2_TRIGGERYPOPIS.htm">Popis triggeru</a>

<li><a href="../xml/html/updatetrigger.html">Spouštìní UPDATE triggerù s uvedenım seznamem sloupcù</a>

<li><a href="../xml/html/triggerform.html">Volání triggerù pøi ukládání zmìn ve formuláøi</a>

<li><a href="HE_SQL2_CREATETRIGGER.htm">Pøíkaz CREATE TRIGGER</a>

<li><a href="HE_SQL2_ALTERTRIGGER.htm">Pøíkaz ALTER TRIGGER</a>

<li><a href="HE_SQL2_DROPTRIGGER.htm">Pøíkaz DROP TRIGGER</a>

<li><a href="HE_SQL2_EFTRIG.htm">Efektivita triggerù</a>

</ul>
<table class="navigace" border="0" width="100%"  bgcolor="#FFFFBF"><tr> <td
width="20" align="center"><img class="floatno" src="../images/prev.gif"
width="15" height="13" alt="&lt;&shy;" title="Pøedcházející téma"
border="0"></td><td width="25%"><a
href="HE_SQL2_STOREDPROCEDURE.htm">Rutiny uloené na serveru</a></td> <td width="25%"
align="right"><img class="floatno" src="../images/up.gif" width="13"
height="15" alt="Nahoru" title="O jednu úroveò vıš" border="0"
align="middle"></td><td width="25%"><a href="HE_SQL2_JAZYKSQL.htm">Jazyk SQL a jeho implementace</a></td>
<td width="25%" align="right"><a
href="HE_SQL2_SEKVENCE.htm">Sekvence</a></td><td width="20"
align="center"><img class="floatno" src="../images/next.gif" width="15"
height="13" alt="&shy;&gt;" title="Následující téma" border="0"></td>
</tr></table>
</body>
</html>

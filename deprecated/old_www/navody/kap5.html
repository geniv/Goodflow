<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=Windows-1250"><title>5. Pohledy</title>


	
    <link rel="STYLESHEET" type="text/css" href="kap5_soubory/main.css">
	<style type="text/css"><!--:hover { font-weight: bold;         color: red }
--></style></head><body alink="Blue" background="kap5_soubory/pozadi.jpg" vlink="Blue">
<a name="k"></a>
<a href="http://www.cs.vsb.cz/amalka/tomica/sql/kap4.html"><img src="kap5_soubory/prev.gif" alt="4. Systémový katalog"></a>
<a href="http://www.cs.vsb.cz/amalka/tomica/sql/kap6.html"><img src="kap5_soubory/next.gif" alt="6. Ochrana dat proti neoprávnìnému pøístupu"></a>
<a href="http://www.cs.vsb.cz/amalka/tomica/sql/index.html"><img src="kap5_soubory/toc.gif" alt="Obsah"></a>
<hr color="Blue" size="1">
<h1>5. Pohledy</h1>
<dt><a href="#k1">5.1 Aktualizace pohledù</a></dt>
<p>Pohledy jsou virtuální relace implementující externí schémata. Každý
pohled umožòuje vidìt aplikaci uživatelskýma oèima. Uvažujme napø.
uživatele-knihovníka, kterého zajímají pouze pražští ètenáøi (zasílá
jim napø. seznam pøírùstkù). Pohled vyjadøující tento fakt lze zapsat
následovnì:</p>
<pre>CREATE VIEW Prazak
    AS SELECT cislo,jmeno,adresa
       FROM Ctenar
       WHERE adresa LIKE '%PRAHA%'</pre>
<p>Jiným pohledem by byla napø. STATISTIKA definovaná jako</p>
<pre>CREATE VIEW Statistika (cislo,pocet)
    AS SELECT cislo, COUNT(id_v )
       FROM Vypujcka
       GROUP BY cislo</pre>
<p>Pøíkaz pro vytvoøení pohledu je dán kombinací definice schématu
virtuální relace a zobrazení specifikujícího, jak se prvky této relace
odvodí z prvkù jiných relací.</p>
<pre>CREATE VIEW jméno-pohledu [(v jméno-atrl[,v jméno-atr2]...)]
    AS SELECT [DISTINCT] {* jméno-atrl[,jméno-atr2]...}
       FROM jméno-rel l [,jméno-rel2]...
       [WHERE podmínkal]
	   [GROUP BY o jméno-atrl[,o-jméno-atr2]...
	   [HAVING podmínka2]]&gt;
	   [ENABLE UPDATES]</pre>
<p class="BEZ">kde poslední klauzule pøíkazu oznaèuje, že je možné vkládat nebo mìnit prvky pohledu.</p>
<p>Narozdíl od pøípadu, kdy se definuje relace a "naplní" fyzicky daty,
v pøípadì pohledu STATISTIKA se do katalogu uloží schéma pohledu. tj.
schéma specifikované relace spolu se zobrazením, které definuje pohled
nad základními relacemi. Atributy pohledu se definují stejnì jako
atributy jiných tabulek. Jména se bud' dìdí ze zdrojových relací
pohledu, nebo se specifikují explicitnì, dochází-li ke dvojznaènostem,
nebo když jméno atributu neexistuje (pøi použití agregaèní funkce èi
aritmetického výrazu). Podobnì se dìdí typ atributu.</p>
<p>Jazyk SQL neklade žádná omezení na tvorbu pohledù, omezení vznikají
v jednotlivých SØBD (napø. v INFORMIXu nesmí být za AS použito UNION).
Pohledy lze rušit pøíkazem DROP VIEW. Napø.</p>
<pre>DROP VIEW Prazak</pre>
<p>zajistí odstranìní definice pohledu Prazak z katalogu. Zruší-li se základní relace Ctenar. zruší se Prazak automaticky.</p>
<p>Pøíkaz SELECT lze nyní rozšíøit i na pohledy. Pøi vyhodnocení dotazu
se zobrazení popisující pohled zkombinuje s podmínkami v dotazu.
Existující implementace SQL však obvykle neumožòují stoprocentní
použití SQL pro výbìr nad pohledy.</p>
<p>
</p><h2><a name="k1"></a>5.1 Aktualizace pohledù</h2>
<a href="#k"><img src="kap5_soubory/toc.gif" alt="Obsah 5. kapitoly"></a>
<p>Skuteèným problémem je aktualizace pohledù. Ne na všech pohledech
lze totiž použít aktualizaèní operace. Uvìdomme si, že v pøípadì
aktualizace základních relací žádné problémy nevznikají. Virtuálnì se
pohledy aktualizují automaticky, tak jak se aktualizují základní
relace, nad kterými jsou pohledy definovány.</p>
<p>Uvažujme nejprve pøípad, kdy pohled vznikne omezením jedné relace. Jsou možné tøi typy takových omezení:</p>
<dt><b>projektivní</b> (omezuje sloupce),</dt>
<dt><b>selektivní</b> (omezuje øádky),</dt>
<dt><b>agregaèní</b> (atribut je definován agregaèní funkcí).</dt>
<p>Zachovává-li projektivní omezení primární klíè, pak je dovolena
jakákoli aktualizace. Do tabulky pohledu lze napø. vložit další n-tici,
což implikuje vložení jisté n-tice do základu relace. Problémem však
mùže být, když je tøeba vložit prázdnou hodnotu, pøièemž daný atribut v
základní relaci byl definován jako NOT NULL.</p>
<p>Jestliže projektivní omezení nezachovává primární klíè, nemusí být
aktualizace "dobøe", definovány. Také projekce na pouze neklíèové
atributy relací, které jsou dobøe navrženu ,jsou napø. v 3.NF [Po92]),
zøejmì nevedou ke smysluplným pohledùm.</p>
<p>Protože selektivní omezení zachovává primární klíè vždy, neposkytuje
tento pøípad nic zajímavého k øešení. Agregaèní omezení (viz napø.
pohled STATISTIKA) nevedou pohledùm, které by mohly být smysluplnì
aktualizovány.</p>
<p>Uvažujme nyní pohledy, které vzniknou spojením dvou nebo více
relací. Ve vìtšinì pøípadu opìt nevede aktualizace takového pohledu k
jednoznaènì (a smysluplnì) definovaným aktualizacím základních relací.</p>
<p>Problémy však mohou vzniknout i v na první pohled jasných pøípadech
s jednou základní relací. Napø. Prazak je pohled, který vznikl selekcí
prvkù relace Ctenar. Provedeme-li na nìj aktualizaci adresy napø.
použití operace INSERT tak, že nebude nová adresa pražská. nezmìní se
pohled, nýbrž pouze základní relace. Zabránit tomuto patologickému
pøípadu lze v SQL tím, že se v definici pohledu použije klauzule WITH
CHECK OPTION, která po aktivaci kontroluje, zda aktualizací nebyla
narušena podmínka v definici pohledu.</p>
<p>Aktualizace pohledù je složitá i teoreticky. Souèasné SØBD s SQL se
jí vyhýbají tím. že pøipouštìjí pouze omezené možností pro aktualizaci
pohledù. V DB2 nebo v dBASE IV je aktualizace možná jen na projektivním
a/nebo selektivním omezení základních relaci. Standard SQL specifikuje
tzv. aktualizovatelné pohledy, které jsou založeny na projektivním a
selektivním omezení jedné relace, pøièemž je zakázáno použít DISTINCT,
GROUP BY' a hnízdìný SELECT blok.</p>
<p>Schémata relací a definice pohledù lze kombinovat do schématu
databáze pøíkazem CREATE SCHEMA (viz. kap 1), po nìmž následují
schémata relací a pohledù.</p>
<hr color="Blue" size="1">
<a href="http://www.cs.vsb.cz/amalka/tomica/sql/kap4.html"><img src="kap5_soubory/prev.gif" alt="4. Systémový katalog" align="left"></a>
<a href="http://www.cs.vsb.cz/amalka/tomica/sql/kap6.html"><img src="kap5_soubory/next.gif" alt="6. Ochrana dat proti neoprávnìnému pøístupu" align="left"></a>
<a href="http://www.cs.vsb.cz/amalka/tomica/sql/index.html"><img src="kap5_soubory/toc.gif" alt="Obsah" align="left"></a>
</body></html>
<html><head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></head>  <body><code><font color="#000000">
<font color="#0000bb">&lt;?<br>&nbsp;&nbsp;</font><font color="#007700">function </font><font color="#0000bb">JeEmail </font><font color="#007700">(</font><font color="#0000bb">$cislo</font><font color="#007700">)<br>&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;return </font><font color="#0000bb">ereg</font><font color="#007700">(</font><font color="#dd0000">"^.+@.+\..+$"</font><font color="#007700">,</font><font color="#0000bb">$cislo</font><font color="#007700">);<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;function </font><font color="#0000bb">emailvdb </font><font color="#007700">(</font><font color="#0000bb">$email</font><font color="#007700">)<br>&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000bb">$vysledek</font><font color="#007700">=</font><font color="#0000bb">mysql_query</font><font color="#007700">(</font><font color="#dd0000">"select * from uzivatele where email='"</font><font color="#007700">.</font><font color="#0000bb">$email</font><font color="#007700">.</font><font color="#dd0000">"'"</font><font color="#007700">, </font><font color="#0000bb">$GLOBALS</font><font color="#007700">[</font><font color="#dd0000">"link"</font><font color="#007700">]);<br>&nbsp;&nbsp;&nbsp;&nbsp;return (boolean) </font><font color="#0000bb">mysql_num_rows</font><font color="#007700">(</font><font color="#0000bb">$vysledek</font><font color="#007700">);<br>&nbsp;&nbsp;}&nbsp;&nbsp;<br><br>&nbsp;&nbsp;function </font><font color="#0000bb">prezdivkavdb </font><font color="#007700">(</font><font color="#0000bb">$prezdivka</font><font color="#007700">)<br>&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000bb">$vysledek</font><font color="#007700">=</font><font color="#0000bb">mysql_query</font><font color="#007700">(</font><font color="#dd0000">"select * from uzivatele where prezdivka='"</font><font color="#007700">.</font><font color="#0000bb">$prezdivka</font><font color="#007700">.</font><font color="#dd0000">"'"</font><font color="#007700">, </font><font color="#0000bb">$GLOBALS</font><font color="#007700">[</font><font color="#dd0000">"link"</font><font color="#007700">]);<br>&nbsp;&nbsp;&nbsp;&nbsp;return (boolean) </font><font color="#0000bb">mysql_num_rows</font><font color="#007700">(</font><font color="#0000bb">$vysledek</font><font color="#007700">);<br>&nbsp;&nbsp;}&nbsp;&nbsp;<br>&nbsp;&nbsp;<br>&nbsp;&nbsp;</font><font color="#0000bb">$BudemeZobrazovat</font><font color="#007700">=</font><font color="#0000bb">true</font><font color="#007700">;<br>&nbsp;&nbsp;if (!empty(</font><font color="#0000bb">$_POST</font><font color="#007700">)) </font><font color="#ff8000">// už se odeslalo<br>&nbsp;&nbsp;</font><font color="#007700">{<br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#ff8000">/*<br>&nbsp;&nbsp;&nbsp;&nbsp;budeme kontrolovat následující věci:<br>&nbsp;&nbsp;&nbsp;&nbsp;1) e-mailovou adresu<br>&nbsp;&nbsp;&nbsp;&nbsp;2) zda tam již e-mail není<br>&nbsp;&nbsp;&nbsp;&nbsp;3) zda tam již přezdívka není<br>&nbsp;&nbsp;&nbsp;&nbsp;4) zda je přezdívka mezi 3 a 50 znaky délky<br>&nbsp;&nbsp;&nbsp;&nbsp;5) zda je heslo 3 až 50 znaků dlouhé<br>&nbsp;&nbsp;&nbsp;&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">if (!</font><font color="#0000bb">JeEmail</font><font color="#007700">(</font><font color="#0000bb">$_POST</font><font color="#007700">[</font><font color="#dd0000">"email"</font><font color="#007700">])) echo </font><font color="#dd0000">"Není zadán platný e-mail"</font><font color="#007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;elseif (</font><font color="#0000bb">emailvdb</font><font color="#007700">(</font><font color="#0000bb">$_POST</font><font color="#007700">[</font><font color="#dd0000">"email"</font><font color="#007700">])) echo </font><font color="#dd0000">"Uvedený e-mail je již registrován"</font><font color="#007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;elseif (</font><font color="#0000bb">prezdivkavdb </font><font color="#007700">(</font><font color="#0000bb">$_POST</font><font color="#007700">[</font><font color="#dd0000">"prezdivka"</font><font color="#007700">])) <br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo </font><font color="#dd0000">"Uvedená přezdívka je již registrována "</font><font color="#007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo </font><font color="#dd0000">"(&lt;a href=\"index.php?clanek=zapomenuteheslo\"&gt;připomenout heslo&lt;/a&gt;)"</font><font color="#007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;elseif ((</font><font color="#0000bb">strlen </font><font color="#007700">(</font><font color="#0000bb">$_POST</font><font color="#007700">[</font><font color="#dd0000">"prezdivka"</font><font color="#007700">])&gt;</font><font color="#0000bb">50</font><font color="#007700">) | </font><font color="#0000bb">strlen </font><font color="#007700">(</font><font color="#0000bb">$_POST</font><font color="#007700">[</font><font color="#dd0000">"prezdivka"</font><font color="#007700">])&lt;</font><font color="#0000bb">3</font><font color="#007700">)echo </font><font color="#dd0000">"Přezdívka musí mít 3-50 znaků"</font><font color="#007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;elseif ((</font><font color="#0000bb">strlen </font><font color="#007700">(</font><font color="#0000bb">$_POST</font><font color="#007700">[</font><font color="#dd0000">"heslo"</font><font color="#007700">])&gt;</font><font color="#0000bb">50</font><font color="#007700">) | </font><font color="#0000bb">strlen </font><font color="#007700">(</font><font color="#0000bb">$_POST</font><font color="#007700">[</font><font color="#dd0000">"heslo"</font><font color="#007700">])&lt;</font><font color="#0000bb">3</font><font color="#007700">) echo </font><font color="#dd0000">"Heslo musí mít 3-50 znaků"</font><font color="#007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;else<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#ff8000">// kontolou jsme prošli<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000bb">$BudemeZobrazovat</font><font color="#007700">=</font><font color="#0000bb">false</font><font color="#007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#ff8000">// poděkujeme uživateli<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">echo </font><font color="#dd0000">"Děkujeme za registraci. Na vaši adresu "</font><font color="#007700">.</font><font color="#0000bb">$_POST</font><font color="#007700">[</font><font color="#dd0000">"email"</font><font color="#007700">].</font><font color="#dd0000">" byly zaslány informace pro její dokončení."</font><font color="#007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#ff8000">// uložíme to do databáze<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000bb">mysql_query </font><font color="#007700">(</font><font color="#dd0000">"insert into uzivatele (email, prezdivka, heslo) values ('"</font><font color="#007700">.</font><font color="#0000bb">$_POST</font><font color="#007700">[</font><font color="#dd0000">"email"</font><font color="#007700">].</font><font color="#dd0000">"', '"</font><font color="#007700">.</font><font color="#0000bb">$_POST</font><font color="#007700">[</font><font color="#dd0000">"prezdivka"</font><font color="#007700">].</font><font color="#dd0000">"', '"</font><font color="#007700">.</font><font color="#0000bb">$_POST</font><font color="#007700">[</font><font color="#dd0000">"heslo"</font><font color="#007700">].</font><font color="#dd0000">"');"</font><font color="#007700">, </font><font color="#0000bb">$GLOBALS</font><font color="#007700">[</font><font color="#dd0000">"link"</font><font color="#007700">]);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000bb">$lastid</font><font color="#007700">=</font><font color="#0000bb">mysql_insert_id</font><font color="#007700">();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#ff8000">// a sestavíme e-mail s instrukcemi, jak registraci dokončí<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000bb">$sifra</font><font color="#007700">= new </font><font color="#0000bb">Crypt_Xtea</font><font color="#007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000bb">$citlive</font><font color="#007700">=</font><font color="#0000bb">$lastid</font><font color="#007700">.</font><font color="#dd0000">"|"</font><font color="#007700">.</font><font color="#0000bb">$_POST</font><font color="#007700">[</font><font color="#dd0000">"email"</font><font color="#007700">];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000bb">$citlive</font><font color="#007700">=</font><font color="#0000bb">urlencode</font><font color="#007700">(</font><font color="#0000bb">base64_encode</font><font color="#007700">(</font><font color="#0000bb">$sifra</font><font color="#007700">-&gt;</font><font color="#0000bb">encrypt</font><font color="#007700">((string)</font><font color="#0000bb">$citlive</font><font color="#007700">, </font><font color="#dd0000">"T3dX?2.5du"</font><font color="#007700">)));<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000bb">$path</font><font color="#007700">=</font><font color="#dd0000">"http://"</font><font color="#007700">.</font><font color="#0000bb">$_SERVER</font><font color="#007700">[</font><font color="#dd0000">"SERVER_NAME"</font><font color="#007700">].</font><font color="#dd0000">":"</font><font color="#007700">.</font><font color="#0000bb">$_SERVER</font><font color="#007700">[</font><font color="#dd0000">"SERVER_PORT"</font><font color="#007700">].</font><font color="#0000bb">$_SERVER</font><font color="#007700">[</font><font color="#dd0000">"SCRIPT_NAME"</font><font color="#007700">].</font><font color="#dd0000">"?clanek=registracedokoncena&amp;amp;id="</font><font color="#007700">.</font><font color="#0000bb">$citlive</font><font color="#007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000bb">$telo </font><font color="#007700">= </font><font color="#dd0000">"Dekujeme Vam za registraci na nasem portale [nazev hudebniho portalu]. Pro dokonceni "</font><font color="#007700">.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#dd0000">"registrace navstivte nasledujici odkaz\n\n$path\n\n"</font><font color="#007700">.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#dd0000">"Pokud jste se na nasem portale nechteli zaregistrovat, povazujte tento e-mail za bezpredmetny.\n"</font><font color="#007700">.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#dd0000">"Vas [nazev hudebniho portalu] team."</font><font color="#007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</font><font color="#0000bb">mail </font><font color="#007700">(</font><font color="#0000bb">$_POST</font><font color="#007700">[</font><font color="#dd0000">"email"</font><font color="#007700">], </font><font color="#dd0000">"Registrace na portalu"</font><font color="#007700">, </font><font color="#0000bb">$telo</font><font color="#007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;}<br>if (</font><font color="#0000bb">$BudemeZobrazovat</font><font color="#007700">):</font><font color="#0000bb">?&gt;<br></font>&nbsp;&nbsp;&lt;form method="post" action="index.php?clanek=registrace"&gt;<br>&nbsp;&nbsp;&lt;table&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;Přezdívka:&lt;/td&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;&lt;input name="prezdivka" value="<font color="#0000bb">&lt;?</font><font color="#007700">echo </font><font color="#0000bb">$_POST</font><font color="#007700">[</font><font color="#dd0000">"prezdivka"</font><font color="#007700">]</font><font color="#0000bb">?&gt;</font>"&gt;&lt;/td&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;E-mail:&lt;/td&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;&lt;input name="email" value="<font color="#0000bb">&lt;?</font><font color="#007700">echo </font><font color="#0000bb">$_POST</font><font color="#007700">[</font><font color="#dd0000">"email"</font><font color="#007700">]</font><font color="#0000bb">?&gt;</font>"&gt;&lt;/td&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;Heslo:&lt;/td&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;&lt;input name="heslo" type = "password" value="<font color="#0000bb">&lt;?</font><font color="#007700">echo </font><font color="#0000bb">$_POST</font><font color="#007700">[</font><font color="#dd0000">"heslo"</font><font color="#007700">]</font><font color="#0000bb">?&gt;</font>"&gt;&lt;/td&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td
colspan="2"&gt;&lt;input type="Submit" name="odesli"
value="Zaregistrovat"&gt;&lt;/td&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br>&nbsp;&nbsp;&lt;/table&gt;<br>&nbsp;&nbsp;&lt;/form&gt;<br><font color="#0000bb">&lt;?</font><font color="#007700">endif;</font><font color="#0000bb">?&gt;<br></font>
</font>
</code>
</body></html>
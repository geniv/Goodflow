<html><head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></head>  <body><code><font color="#000000">
<font color="#0000bb">&lt;?<br>&nbsp;&nbsp;</font><font color="#007700">function </font><font color="#0000bb">naplnseznam </font><font color="#007700">(</font><font color="#0000bb">$zvoleno</font><font color="#007700">)<br>&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000bb">$vysledek</font><font color="#007700">=</font><font color="#0000bb">mysql_query</font><font color="#007700">(</font><font color="#dd0000">"select pisne.id, pisne.nazev from pisne left join texty on pisne.id = texty.pisen where texty.pisen is null order by nazev"</font><font color="#007700">,</font><font color="#0000bb">$GLOBALS</font><font color="#007700">[</font><font color="#dd0000">"link"</font><font color="#007700">]);<br>&nbsp;&nbsp;&nbsp;&nbsp;while (</font><font color="#0000bb">$zaznam</font><font color="#007700">=</font><font color="#0000bb">MySQL_Fetch_Array</font><font color="#007700">(</font><font color="#0000bb">$vysledek</font><font color="#007700">)):<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (</font><font color="#0000bb">$zaznam</font><font color="#007700">[</font><font color="#dd0000">"id"</font><font color="#007700">]==</font><font color="#0000bb">$zvoleno</font><font color="#007700">)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000bb">$options</font><font color="#007700">.=</font><font color="#dd0000">"&lt;option value=\""</font><font color="#007700">.</font><font color="#0000bb">$zaznam</font><font color="#007700">[</font><font color="#dd0000">"id"</font><font color="#007700">].</font><font color="#dd0000">"\" selected&gt;"</font><font color="#007700">.</font><font color="#0000bb">$zaznam</font><font color="#007700">[</font><font color="#dd0000">"nazev"</font><font color="#007700">].</font><font color="#dd0000">"&lt;/option&gt;\n"</font><font color="#007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000bb">$options</font><font color="#007700">.=</font><font color="#dd0000">"&lt;option value=\""</font><font color="#007700">.</font><font color="#0000bb">$zaznam</font><font color="#007700">[</font><font color="#dd0000">"id"</font><font color="#007700">].</font><font color="#dd0000">"\"&gt;"</font><font color="#007700">.</font><font color="#0000bb">$zaznam</font><font color="#007700">[</font><font color="#dd0000">"nazev"</font><font color="#007700">].</font><font color="#dd0000">"&lt;/option&gt;\n"</font><font color="#007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;endwhile;<br>&nbsp;&nbsp;&nbsp;&nbsp;return </font><font color="#0000bb">$options</font><font color="#007700">;<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;if (!</font><font color="#0000bb">jeadmin</font><font color="#007700">()) return;<br><br><br><br>if (</font><font color="#0000bb">$_REQUEST</font><font color="#007700">[</font><font color="#dd0000">"odeslano"</font><font color="#007700">]==</font><font color="#0000bb">1</font><font color="#007700">):<br>&nbsp;&nbsp;@</font><font color="#0000bb">unlink </font><font color="#007700">(</font><font color="#dd0000">"./textpisne.txt"</font><font color="#007700">);<br>&nbsp;&nbsp;</font><font color="#ff8000">// kontroly...<br>&nbsp;&nbsp;</font><font color="#007700">if (</font><font color="#0000bb">move_uploaded_file</font><font color="#007700">(</font><font color="#0000bb">$_FILES</font><font color="#007700">[</font><font color="#dd0000">'textpisne'</font><font color="#007700">][</font><font color="#dd0000">'tmp_name'</font><font color="#007700">], </font><font color="#dd0000">"./textpisne.txt"</font><font color="#007700">))<br>&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000bb">$velikost</font><font color="#007700">=</font><font color="#0000bb">filesize</font><font color="#007700">(</font><font color="#dd0000">"./textpisne.txt"</font><font color="#007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;if (</font><font color="#0000bb">$velikost</font><font color="#007700">==</font><font color="#0000bb">0 </font><font color="#007700">or </font><font color="#0000bb">$velikost</font><font color="#007700">&gt;</font><font color="#0000bb">20000</font><font color="#007700">) echo </font><font color="#dd0000">"Nesprávná délka souboru."</font><font color="#007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;else<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000bb">$fp </font><font color="#007700">= </font><font color="#0000bb">fopen</font><font color="#007700">(</font><font color="#dd0000">"./textpisne.txt"</font><font color="#007700">, </font><font color="#dd0000">"r"</font><font color="#007700">); <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000bb">$textpisne </font><font color="#007700">= </font><font color="#0000bb">addslashes</font><font color="#007700">(</font><font color="#0000bb">fread</font><font color="#007700">(</font><font color="#0000bb">$fp</font><font color="#007700">, </font><font color="#0000bb">$velikost</font><font color="#007700">)); <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000bb">mysql_query</font><font color="#007700">(</font><font color="#dd0000">"insert into texty (pisen, textpisne) values ("</font><font color="#007700">.</font><font color="#0000bb">$_POST</font><font color="#007700">[</font><font color="#dd0000">"pisen"</font><font color="#007700">].</font><font color="#dd0000">", '"</font><font color="#007700">.</font><font color="#0000bb">$textpisne</font><font color="#007700">.</font><font color="#dd0000">"');"</font><font color="#007700">,</font><font color="#0000bb">$GLOBALS</font><font color="#007700">[</font><font color="#dd0000">"link"</font><font color="#007700">]);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (</font><font color="#0000bb">mysql_affected_rows</font><font color="#007700">()==</font><font color="#0000bb">1</font><font color="#007700">) echo </font><font color="#dd0000">"Text písně byl uložen."</font><font color="#007700">; else echo </font><font color="#dd0000">"Text písně nebyl uložen. Databáze vrátila chybu: "</font><font color="#007700">.</font><font color="#0000bb">mysql_error</font><font color="#007700">();<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;}<br>&nbsp;&nbsp;else<br>&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;echo </font><font color="#dd0000">"Soubor se nepodařilo nahrát na server."</font><font color="#007700">;<br>&nbsp;&nbsp;};<br>&nbsp;&nbsp;@</font><font color="#0000bb">unlink </font><font color="#007700">(</font><font color="#dd0000">"./textpisne.txt"</font><font color="#007700">);<br>else:<br></font><font color="#0000bb">?&gt;<br></font>&nbsp;&nbsp;&nbsp;&nbsp;&lt;H1&gt;Nahrání souboru na server&lt;/H1&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;form method="POST" ENCTYPE="multipart/form-data" action="index.php?clanek=nahrajtextpisne"&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;table border="1" &gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;Píseň:&lt;/td&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td colspan="2"&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;select name="pisen"&gt;<font color="#0000bb">&lt;?</font><font color="#007700">echo </font><font color="#0000bb">naplnseznam</font><font color="#007700">(</font><font color="#0000bb">$_POST</font><font color="#007700">[</font><font color="#dd0000">"pisen"</font><font color="#007700">])</font><font color="#0000bb">?&gt;</font>&lt;/select&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;Text písně:&lt;/td&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;input type="HIDDEN" name="MAX_FILE_SIZE" VALUE=20000&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;input type="file" name="textpisne" ACCEPT="text/*"&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/td&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;(max. 20kB, UTF-8)&lt;/td&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td colspan="3"&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;input
type="hidden" name="odeslano" value="1"&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p
align="center"&gt;&lt;input type="submit" value="Odeslat"&gt;&lt;/td&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/table&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/form&gt;<br><font color="#0000bb">&lt;?<br></font><font color="#007700">endif;<br></font><font color="#0000bb">?&gt;</font> <br></font>
</code>
</body></html>
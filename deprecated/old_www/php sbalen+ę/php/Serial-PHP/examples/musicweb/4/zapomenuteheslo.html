<html><head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></head>  <body><code><font color="#000000">
<font color="#0000bb">&lt;?<br>&nbsp;&nbsp;</font><font color="#007700">function </font><font color="#0000bb">idzPrezdivkyNeboEmailu </font><font color="#007700">(</font><font color="#0000bb">$udaj</font><font color="#007700">, </font><font color="#0000bb">$link</font><font color="#007700">)<br>&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#ff8000">/* ověří, zda zaslaný údaj může být existující přezdívka nebo existující e-mail<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v tabulce uživatelů. Vrátí false, pokud se nic nenašlo, v opačném případě<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vrátí ID uživatele s daným mailem nebo přezdívkou<br>&nbsp;&nbsp;&nbsp;&nbsp;*/<br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">if (</font><font color="#0000bb">strpos</font><font color="#007700">(</font><font color="#0000bb">$udaj</font><font color="#007700">,</font><font color="#dd0000">"@"</font><font color="#007700">)===</font><font color="#0000bb">false</font><font color="#007700">) </font><font color="#ff8000">//začneme prohledávat přezdívky<br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000bb">$vysledek</font><font color="#007700">=</font><font color="#0000bb">mysql_query</font><font color="#007700">(</font><font color="#dd0000">"select id from uzivatele where registracedokoncena=1 and prezdivka='"</font><font color="#007700">.</font><font color="#0000bb">$udaj</font><font color="#007700">.</font><font color="#dd0000">"'"</font><font color="#007700">, </font><font color="#0000bb">$link</font><font color="#007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (</font><font color="#0000bb">mysql_num_rows</font><font color="#007700">(</font><font color="#0000bb">$vysledek</font><font color="#007700">)==</font><font color="#0000bb">0</font><font color="#007700">) <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return </font><font color="#0000bb">false</font><font color="#007700">; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000bb">$radek </font><font color="#007700">= </font><font color="#0000bb">mysql_fetch_array</font><font color="#007700">(</font><font color="#0000bb">$vysledek</font><font color="#007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return </font><font color="#0000bb">$radek</font><font color="#007700">[</font><font color="#dd0000">"id"</font><font color="#007700">];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;else </font><font color="#ff8000">//je tam zavináč, začneme prohledávat e-mailové adresy<br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000bb">$vysledek</font><font color="#007700">=</font><font color="#0000bb">mysql_query</font><font color="#007700">(</font><font color="#dd0000">"select id from uzivatele where registracedokoncena=1 and email='"</font><font color="#007700">.</font><font color="#0000bb">$udaj</font><font color="#007700">.</font><font color="#dd0000">"'"</font><font color="#007700">, </font><font color="#0000bb">$link</font><font color="#007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (</font><font color="#0000bb">mysql_num_rows</font><font color="#007700">(</font><font color="#0000bb">$vysledek</font><font color="#007700">)==</font><font color="#0000bb">0</font><font color="#007700">) <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#ff8000">// nevzdáme to. Konec konců, zavináč může být i v přezdívce<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000bb">$vysledek</font><font color="#007700">=</font><font color="#0000bb">mysql_query</font><font color="#007700">(</font><font color="#dd0000">"select id from uzivatele where registracedokoncena=1 and prezdivka='"</font><font color="#007700">.</font><font color="#0000bb">$udaj</font><font color="#007700">.</font><font color="#dd0000">"'"</font><font color="#007700">, </font><font color="#0000bb">$link</font><font color="#007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (</font><font color="#0000bb">mysql_num_rows</font><font color="#007700">(</font><font color="#0000bb">$vysledek</font><font color="#007700">)==</font><font color="#0000bb">0</font><font color="#007700">) <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return </font><font color="#0000bb">false</font><font color="#007700">; <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000bb">$radek </font><font color="#007700">= </font><font color="#0000bb">mysql_fetch_array</font><font color="#007700">(</font><font color="#0000bb">$vysledek</font><font color="#007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return </font><font color="#0000bb">$radek</font><font color="#007700">[</font><font color="#dd0000">"id"</font><font color="#007700">];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000bb">$radek </font><font color="#007700">= </font><font color="#0000bb">mysql_fetch_array</font><font color="#007700">(</font><font color="#0000bb">$vysledek</font><font color="#007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return </font><font color="#0000bb">$radek</font><font color="#007700">[</font><font color="#dd0000">"id"</font><font color="#007700">];<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;}&nbsp;&nbsp;<br>&nbsp;&nbsp;<br>&nbsp;&nbsp;function </font><font color="#0000bb">emailzid </font><font color="#007700">(</font><font color="#0000bb">$id</font><font color="#007700">, </font><font color="#0000bb">$link</font><font color="#007700">)<br>&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000bb">$vysledek</font><font color="#007700">=</font><font color="#0000bb">mysql_query</font><font color="#007700">(</font><font color="#dd0000">"select email from uzivatele where id="</font><font color="#007700">.</font><font color="#0000bb">$id</font><font color="#007700">, </font><font color="#0000bb">$link</font><font color="#007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000bb">$radek </font><font color="#007700">= </font><font color="#0000bb">mysql_fetch_array</font><font color="#007700">(</font><font color="#0000bb">$vysledek</font><font color="#007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;return </font><font color="#0000bb">$radek</font><font color="#007700">[</font><font color="#dd0000">"email"</font><font color="#007700">];&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;function </font><font color="#0000bb">heslozid </font><font color="#007700">(</font><font color="#0000bb">$id</font><font color="#007700">, </font><font color="#0000bb">$link</font><font color="#007700">)<br>&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000bb">$vysledek</font><font color="#007700">=</font><font color="#0000bb">mysql_query</font><font color="#007700">(</font><font color="#dd0000">"select heslo from uzivatele where id="</font><font color="#007700">.</font><font color="#0000bb">$id</font><font color="#007700">, </font><font color="#0000bb">$link</font><font color="#007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000bb">$radek </font><font color="#007700">= </font><font color="#0000bb">mysql_fetch_array</font><font color="#007700">(</font><font color="#0000bb">$vysledek</font><font color="#007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;return </font><font color="#0000bb">$radek</font><font color="#007700">[</font><font color="#dd0000">"heslo"</font><font color="#007700">];&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;function </font><font color="#0000bb">pripomenutozid </font><font color="#007700">(</font><font color="#0000bb">$id</font><font color="#007700">, </font><font color="#0000bb">$link</font><font color="#007700">)<br>&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000bb">$vysledek</font><font color="#007700">=</font><font color="#0000bb">mysql_query</font><font color="#007700">(</font><font color="#dd0000">"select unix_timestamp(now()) - unix_timestamp(pripomenuto) from uzivatele where id="</font><font color="#007700">.</font><font color="#0000bb">$id</font><font color="#007700">, </font><font color="#0000bb">$link</font><font color="#007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000bb">$radek </font><font color="#007700">= </font><font color="#0000bb">mysql_fetch_array</font><font color="#007700">(</font><font color="#0000bb">$vysledek</font><font color="#007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;return </font><font color="#0000bb">$radek</font><font color="#007700">[</font><font color="#0000bb">0</font><font color="#007700">];&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;</font><font color="#ff8000">// tělo skriptu - nejprve si vytvoříme odkaz na databázi<br>&nbsp;&nbsp;</font><font color="#0000bb">$link</font><font color="#007700">=</font><font color="#0000bb">mysql_connect</font><font color="#007700">(</font><font color="#0000bb">SQL_HOST</font><font color="#007700">, </font><font color="#0000bb">SQL_USERNAME</font><font color="#007700">, </font><font color="#0000bb">SQL_PASSWORD</font><font color="#007700">);<br>&nbsp;&nbsp;</font><font color="#0000bb">mysql_select_db</font><font color="#007700">(</font><font color="#0000bb">SQL_DBNAME</font><font color="#007700">);<br>&nbsp;&nbsp;<br>&nbsp;&nbsp;</font><font color="#0000bb">$BudemeZobrazovat</font><font color="#007700">=</font><font color="#0000bb">true</font><font color="#007700">;<br>&nbsp;&nbsp;if (!empty(</font><font color="#0000bb">$_POST</font><font color="#007700">)) </font><font color="#ff8000">// už se odeslalo<br>&nbsp;&nbsp;</font><font color="#007700">{<br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#ff8000">//údaj pro připomenutí nesmí být prázdný<br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">if ((</font><font color="#0000bb">strlen </font><font color="#007700">(</font><font color="#0000bb">$_POST</font><font color="#007700">[</font><font color="#dd0000">"udaj"</font><font color="#007700">])&gt;</font><font color="#0000bb">50</font><font color="#007700">) | </font><font color="#0000bb">strlen </font><font color="#007700">(</font><font color="#0000bb">$_POST</font><font color="#007700">[</font><font color="#dd0000">"udaj"</font><font color="#007700">])&lt;</font><font color="#0000bb">3</font><font color="#007700">)echo </font><font color="#dd0000">"Údaj musí mít 3-50 znaků"</font><font color="#007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;else<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#ff8000">// kontolou jsme prošli<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000bb">$BudemeZobrazovat</font><font color="#007700">=</font><font color="#0000bb">false</font><font color="#007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000bb">$id</font><font color="#007700">=</font><font color="#0000bb">idzPrezdivkyNeboEmailu</font><font color="#007700">(</font><font color="#0000bb">$_POST</font><font color="#007700">[</font><font color="#dd0000">"udaj"</font><font color="#007700">],</font><font color="#0000bb">$link</font><font color="#007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (!</font><font color="#0000bb">$id</font><font color="#007700">) echo </font><font color="#dd0000">"Bohužel, takový e-mail ani přezdívka neexistují"</font><font color="#007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#ff8000">// zjistíme si e-mail<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000bb">$email </font><font color="#007700">= </font><font color="#0000bb">emailzid</font><font color="#007700">(</font><font color="#0000bb">$id</font><font color="#007700">,</font><font color="#0000bb">$link</font><font color="#007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000bb">$pripomenuto </font><font color="#007700">= </font><font color="#0000bb">pripomenutozid</font><font color="#007700">(</font><font color="#0000bb">$id</font><font color="#007700">, </font><font color="#0000bb">$link</font><font color="#007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (</font><font color="#0000bb">is_null</font><font color="#007700">(</font><font color="#0000bb">$pripomenuto</font><font color="#007700">) | (</font><font color="#0000bb">$pripomenuto</font><font color="#007700">/</font><font color="#0000bb">60</font><font color="#007700">/</font><font color="#0000bb">60</font><font color="#007700">/</font><font color="#0000bb">24</font><font color="#007700">&gt;</font><font color="#0000bb">1</font><font color="#007700">))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo </font><font color="#dd0000">"Na adresu vyplněnou při registraci bylo zasláno přístupové heslo."</font><font color="#007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#ff8000">// uložíme do databáze čas připomenutí<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000bb">mysql_query </font><font color="#007700">(</font><font color="#dd0000">"update uzivatele set pripomenuto = now() where id="</font><font color="#007700">.</font><font color="#0000bb">$id</font><font color="#007700">, </font><font color="#0000bb">$link</font><font color="#007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#ff8000">// a sestavíme e-mail se zapomenutým heslem<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000bb">$telo </font><font color="#007700">= </font><font color="#dd0000">"Pozadovane pristupove heslo na testovaci hudebni portal je \n"</font><font color="#007700">.</font><font color="#0000bb">heslozid</font><font color="#007700">(</font><font color="#0000bb">$id</font><font color="#007700">, </font><font color="#0000bb">$link</font><font color="#007700">).</font><font color="#dd0000">"\n"</font><font color="#007700">.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#dd0000">"Vas [nazev hudebniho portalu] team."</font><font color="#007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@</font><font color="#0000bb">mail </font><font color="#007700">(</font><font color="#0000bb">$email</font><font color="#007700">, </font><font color="#dd0000">"Zaslani hesla"</font><font color="#007700">, </font><font color="#0000bb">$telo</font><font color="#007700">);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo </font><font color="#dd0000">"Nedávno jsme Vám již zaslali zapomenuté heslo. Zkontrolujte svou schránku."</font><font color="#007700">;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;}<br>if (</font><font color="#0000bb">$BudemeZobrazovat</font><font color="#007700">):</font><font color="#0000bb">?&gt;<br></font>&nbsp;&nbsp;&lt;form method="post" action="index.php?clanek=zapomenuteheslo"&gt;<br>&nbsp;&nbsp;&lt;table&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td colspan="2"&gt;Zadejte svou přezdívku nebo e-mail:&lt;/td&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;Přezdívka nebo e-mail:&lt;/td&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td&gt;&lt;input name="udaj" value="<font color="#0000bb">&lt;?</font><font color="#007700">echo </font><font color="#0000bb">$_POST</font><font color="#007700">[</font><font color="#dd0000">"udaj"</font><font color="#007700">]</font><font color="#0000bb">?&gt;</font>"&gt;&lt;/td&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;tr&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;td
colspan="2"&gt;&lt;input type="Submit" name="odesli" value="Poslat
heslo"&gt;&lt;/td&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tr&gt;<br>&nbsp;&nbsp;&lt;/table&gt;<br>&nbsp;&nbsp;&lt;/form&gt;<br><font color="#0000bb">&lt;?</font><font color="#007700">endif;</font><font color="#0000bb">?&gt;<br></font>
</font>
</code>
</body></html>